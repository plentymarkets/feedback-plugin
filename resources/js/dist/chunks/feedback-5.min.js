"use strict";(self.webpackChunkplentymarkets_feedback=self.webpackChunkplentymarkets_feedback||[]).push([[5],{4304:function(e,t,a){a.d(t,{A:function(){return u}});a(115),a(17),a(9581);var i=!1,s=!1,r={setFeedbackAuthenticatedUser:function(e,t){e.authenticatedUser=t,e.invisibleFeedbacks=e.authenticatedUser.feedbacks.filter((function(e){return!e.isVisible}))},setFeedbackCounts:function(e,t){e.counts=t},setFeedbacks:function(e,t){e.feedbacks=e.feedbacks.concat(t)},setFeedbackItemAttributes:function(e,t){e.itemAttributes=t},setFeedbackPagination:function(e,t){e.pagination.lastPage=t.lastPage,e.pagination.isLastPage=t.isLastPage},incrementCurrentFeedbackPage:function(e){e.pagination.currentPage++},addFeedback:function(e,t){if(e.authenticatedUser.feedbacks.unshift(t),e.invisibleFeedbacks.unshift(t),t.isVisible){var a=parseInt(t.feedbackRating.rating.ratingValue);a>0&&a<=5&&(e.counts["ratingsCountOf"+a]++,e.counts.ratingsCountTotal++,l(e))}},deleteFeedback:function(e,t){var a=t.feedbackId,i=t.parentFeedbackId,s=t.feedback;if(s.isVisible&&null===i){var r=parseInt(s.feedbackRating.rating.ratingValue);r>0&&r<=5&&(e.counts["ratingsCountOf"+r]--,e.counts.ratingsCountTotal--,l(e))}null===i?(e.feedbacks=c(e.feedbacks,a),e.authenticatedUser.feedbacks=c(e.authenticatedUser.feedbacks,a),e.invisibleFeedbacks=c(e.invisibleFeedbacks,a)):(e.feedbacks=o(e.feedbacks,i,a),e.authenticatedUser.feedbacks=o(e.authenticatedUser.feedbacks,i,a),e.invisibleFeedbacks=o(e.invisibleFeedbacks,i,a))}},n={loadFeedbackUser:function(e,t){var a=e.commit,i=t.itemId,r=t.variationId;if(!s){s=!0;var n="";return void 0!==i&&void 0!==r&&(n="/".concat(i,"/").concat(r)),$.ajax({type:"GET",url:"/rest/feedbacks/user"+n,success:function(e){a("setFeedbackAuthenticatedUser",e),s=!1},error:function(e,t,a){s=!1,console.error(a)}})}},loadPaginatedFeedbacks:function(e,t){var a=e.commit,s=e.state,r=t.itemId,n=t.feedbacksPerPage,d=t.language;if(!i){i=!0;var c=$.ajax({type:"GET",url:"/rest/storefront/feedbacks/feedback/helper/feedbacklist/"+r+"/"+s.pagination.currentPage,beforeSend:function(e){e.setRequestHeader("lang",d)},data:{feedbacksPerPage:n},success:function(e){a("setFeedbacks",e.feedbacks),a("setFeedbackItemAttributes",e.itemAttributes),a("setFeedbackPagination",e.pagination),a("setFeedbackCounts",e.counts),i=!1},error:function(e,t,a){console.error(a),i=!1}});return d&&a("incrementCurrentFeedbackPage"),c}},deleteFeedback:function(e,t){var a=e.commit,i=(e.state,t.feedbackId),s=t.parentFeedbackId,r=t.feedback;return $.ajax({type:"DELETE",url:"/rest/feedbacks/feedback/delete/"+i,success:function(e){a("deleteFeedback",{feedbackId:i,parentFeedbackId:s,feedback:r})}})}},d={state:function(){return{authenticatedUser:{},invisibleFeedbacks:[],counts:{},feedbacks:[],itemAttributes:[],pagination:{isLastPage:!0,lastPage:1,currentPage:1}}},mutations:r,actions:n,getters:{}};function c(e,t){return e.filter((function(e){return e.id!==t}))}function o(e,t,a){return e.map((function(e){return t===e.id&&(e.replies=e.replies.filter((function(e){return e.id!==a}))),e}))}function l(e){var t=0;t+=5*e.counts.ratingsCountOf5,t+=4*e.counts.ratingsCountOf4,t+=3*e.counts.ratingsCountOf3,t+=2*e.counts.ratingsCountOf2,t+=1*e.counts.ratingsCountOf1,t/=e.counts.ratingsCountTotal,e.counts.averageValue=t}var u={created:function(){this.$store.hasModule("feedback")||App.isSSR||this.$store.registerModule("feedback",d,{preserveState:!!this.$store.state.feedback})}}},6983:function(e,t,a){a.r(t),a.d(t,{default:function(){return p}});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"feedback-container feedback-orderitem-container"},[a("div",{staticClass:"title"},[e._v("\n    "+e._s(e.$translate("Feedback::Feedback.orderItemTitle"))+"\n  ")]),e._v(" "),a("hr"),e._v(" "),e.isLoading?a("div",{staticClass:"w-100 text-center"},[a("p",[e._v(e._s(e.$translate("Feedback::Feedback.loadingItems")))])]):a("div",{staticClass:"feedback-items row"},e._l(e.pagination,(function(t){return a("feedback-order-item",{key:t.variationId,attrs:{item:t,"number-of-columns":e.trueItemsPerRow}})})),1),e._v(" "),!e.isLoading&&e.page*e.options.itemsPerRow*e.options.rowsPerPage<e.orderItems.length?a("button",{staticClass:"btn btn-default btn-block feedback-loadmore",on:{click:function(t){return e.nextPage()}}},[e._v("\n    Weitere Artikel anzeigen\n  ")]):e._e(),e._v(" "),e.isLoading?e._e():a("feedback-order-form",{attrs:{"allow-guest-feedbacks":e.options.allowGuestFeedbacks,"number-of-feedbacks":e.options.numberOfFeedbacks,"access-key":e.accessKey,"order-id":e.orderId,"show-empty-ratings":"true"===e.options.showEmptyRatingsInOrderConfirmation}})],1)};i._withStripped=!0;a(9693),a(4913),a(4009),a(7136),a(173);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"orderItemFeedbackModal",staticClass:"modal fade feedback-orderitem-modal",attrs:{tabindex:"-1",role:"dialog","aria-labelledby":"feedbackOrderItem-"+e._uid,"aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[a("span",{staticClass:"modal-title h3",attrs:{id:"feedbackConfirmDeleteLabel-"+e._uid}},[e._v(e._s(e.$translate("Feedback::Feedback.customerReviews")))]),e._v(" "),e._m(0)]),e._v(" "),a("div",{staticClass:"modal-body row"},[a("div",{staticClass:"col-4"},[a("a",{attrs:{href:e.item.url}},[a("img",{attrs:{src:e.item.image,alt:"image "+e.item.name}})]),e._v(" "),a("fieldset",[a("div",{staticClass:"stars"},[a("legend",[a("span",{staticClass:"d-none"},[e._v(e._s(e.$translate("Feedback::Feedback.customerReviews")))])]),e._v(" "),e._l(e.starIds,(function(t){return[a("input",{directives:[{name:"model",rawName:"v-model",value:e.feedback.ratingValue,expression:"feedback.ratingValue"}],key:"stars_input_"+t.id,class:t.class,attrs:{id:t.id,type:"radio",disabled:e.isRated,name:"ratingValue"},domProps:{value:t.value,checked:e._q(e.feedback.ratingValue,t.value)},on:{change:function(a){return e.$set(e.feedback,"ratingValue",t.value)}}}),e._v(" "),a("label",{key:"stars_label_"+t.id,staticClass:"new_star",attrs:{for:t.id}},[a("span",{staticClass:"d-none"},[e._v(e._s(t.id))]),e._v(" "),a("svg",{class:t.class,staticStyle:{"fill-rule":"evenodd","clip-rule":"evenodd","stroke-linejoin":"round","stroke-miterlimit":"2"},attrs:{for:t.id,width:"100%",height:"100%",viewBox:"0 0 31 30",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","xml:space":"preserve","xmlns:serif":"http://www.serif.com/"}},[a("path",{staticStyle:{"fill-rule":"nonzero"},attrs:{d:"M30.5,11.564c0,0.265 -0.156,0.553 -0.469,0.866l-6.544,6.382l1.55,9.014c0.012,0.085 0.018,0.205 0.018,0.361c0,0.252 -0.063,0.466 -0.189,0.64c-0.126,0.174 -0.31,0.261 -0.55,0.261c-0.228,0 -0.469,-0.072 -0.721,-0.216l-8.095,-4.255l-8.095,4.255c-0.264,0.144 -0.505,0.216 -0.721,0.216c-0.253,0 -0.442,-0.087 -0.568,-0.261c-0.126,-0.174 -0.189,-0.388 -0.189,-0.64c0,-0.072 0.012,-0.192 0.036,-0.361l1.55,-9.014l-6.562,-6.382c-0.301,-0.325 -0.451,-0.613 -0.451,-0.866c0,-0.444 0.337,-0.721 1.01,-0.829l9.05,-1.316l4.057,-8.203c0.228,-0.493 0.522,-0.739 0.883,-0.739c0.361,0 0.655,0.246 0.883,0.739l4.057,8.203l9.05,1.316c0.673,0.108 1.01,0.385 1.01,0.829Z"}})])])]}))],2)])]),e._v(" "),a("div",{staticClass:"col-8"},[a("a",{staticClass:"mb-3",attrs:{id:"feedbackOrderItem-"+e._uid,href:e.item.url}},[e._v(e._s(e.item.name)+"\n            "),e._l(e.item.attributes,(function(t){return[e._v(" | "+e._s(t.attribute.names.name)+": "+e._s(t.value.names.name))]}))],2),e._v(" "),e.authenticatedUser.isLoggedIn?e._e():a("div",{staticClass:"form-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.feedback.authorName,expression:"feedback.authorName"}],staticClass:"form-control",attrs:{id:"author",type:"text",name:"author",disabled:e.isRated||e.limitReached,placeholder:e.$translate("Feedback::Feedback.authorName")},domProps:{value:e.feedback.authorName},on:{input:function(t){t.target.composing||e.$set(e.feedback,"authorName",t.target.value)}}}),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.feedback.honeypot,expression:"feedback.honeypot"}],staticClass:"form-control",attrs:{id:"feedback-textfield",type:"text",disabled:e.isRated||e.limitReached,name:"feedback-textfield","aria-hidden":"true",tabindex:"-1"},domProps:{value:e.feedback.honeypot},on:{input:function(t){t.target.composing||e.$set(e.feedback,"honeypot",t.target.value)}}})]),e._v(" "),a("div",{staticClass:"form-group"},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.feedback.title,expression:"feedback.title"}],staticClass:"form-control",class:{"is-invalid":e.titleMissing},attrs:{id:"title","aria-label":e.$translate("Feedback::Feedback.title"),type:"text",name:"title",disabled:e.isRated||e.limitReached,placeholder:e.$translate("Feedback::Feedback.title")},domProps:{value:e.feedback.title},on:{input:function(t){t.target.composing||e.$set(e.feedback,"title",t.target.value)}}}),e._v(" "),a("div",{staticClass:"invalid-feedback"},[e._v("\n              "+e._s(e.$translate("Feedback::Feedback.titleRequired"))+"\n            ")])]),e._v(" "),a("div",{staticClass:"form-group"},[a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.feedback.message,expression:"feedback.message"}],staticClass:"form-control",attrs:{id:"message","aria-label":e.$translate("Feedback::Feedback.reviewMessage"),name:"message",rows:e.rows,disabled:e.isRated||e.limitReached,placeholder:e.$translate("Feedback::Feedback.reviewMessage")},domProps:{value:e.feedback.message},on:{input:function(t){t.target.composing||e.$set(e.feedback,"message",t.target.value)}}})])])]),e._v(" "),a("div",{staticClass:"modal-footer"},[e.isRated||e.limitReached?e.limitReached?a("div",{staticClass:"w-100 text-center"},[e._v("\n          "+e._s(e.$translate("Feedback::Feedback.maximumNumberOfFeedbacksReached"))+"\n        ")]):a("div",{staticClass:"w-100 text-center"},[e._v("\n          "+e._s(e.$translate("Feedback::Feedback.thankYou"))+"\n        ")]):a("button",{staticClass:"btn btn-primary btn-appearance btn-block",attrs:{type:"button",disabled:e.isRated||e.showEmptyRatings&&0===e.feedback.ratingValue},on:{click:function(t){return e.createFeedback()}}},[e._v("\n          "+e._s(e.$translate("Feedback::Feedback.submitReview"))+"\n        ")])])])])])};s._withStripped=!0;var r=a(5353);function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function d(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var c={name:"FeedbackOrderForm",props:{allowGuestFeedbacks:Boolean,numberOfFeedbacks:Number,accessKey:String,orderId:String,showEmptyRatings:Boolean},data:function(){return{feedback:{ratingValue:0,authorName:"",title:"",message:"",type:"review",targetId:0,honeypot:""},isLoading:!1,isRated:!1,titleMissing:!1,item:{url:"",image:"",variationId:0,name:"",itemId:0,attributes:{}}}},computed:function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(Object(a),!0).forEach((function(t){d(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({starIds:function(){for(var e=[],t=this.isRated?"star-rated":"star",a=5;a>0;a--)e.push({value:a,id:"star-"+a+"-"+this.item.variationId+"-form",class:t});return e},rows:function(){return this.authenticatedUser.id>0?8:6},limitReached:function(){var e=this.item.itemId;return this.authenticatedUser.limitReached[e]}},(0,r.aH)({authenticatedUser:function(e){return e.feedback.authenticatedUser}})),mounted:function(){var e=this;vueEventHub.$on("orderItemFeedback_showform",(function(t){e.prepare(t)}))},methods:{prepare:function(e){this.item=e.item,this.isRated=e.isRated;var t=this;Vue.nextTick((function(){t.feedback=e.feedback,$(t.$refs.orderItemFeedbackModal).modal("show")}))},createFeedback:function(){if(!(this.isLoading||this.feedback.honeypot.length>0))if(this.feedback.title){if(!this.limitReached){this.isLoading=!0,this.feedback.options=this.options,this.feedback.targetId=this.item.variationId,this.feedback.accessKey=this.accessKey,this.feedback.orderId=this.orderId;var e=this;$.ajax({type:"POST",url:"/rest/feedbacks/feedback/create",data:this.feedback,contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"json",xhrFields:{withCredentials:!0},success:function(t){vueEventHub.$emit("orderItemFeedback_created",{feedback:JSON.parse(JSON.stringify(e.feedback))}),e.isLoading=!1,e.feedback.authorName="",e.feedback.message="",e.feedback.title="",e.feedback.ratingValue=0,e.titleMissing=!1,e.ratingMissing=!1,$(e.$refs.orderItemFeedbackModal).modal("hide")},error:function(t,a,i){console.error(i),e.isLoading=!1}})}}else this.titleMissing=!0}}},o=c,l=a(4486),u=(0,l.A)(o,s,[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[e._v("Ã—")])])}],!1,null,null,null);u.options.__file="resources/js/src/app/components/order/FeedbackOrderForm.vue";var m=u.exports,b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"feedback-item mb-4",class:"col-12 col-sm-"+12/e.numberOfColumns},[a("div",{staticClass:"stars",on:{click:function(t){return e.handleRating(0)}}},[a("form",[a("fieldset",{staticClass:"d-flex flex-row-reverse"},[a("legend",[a("span",{staticClass:"d-none"},[e._v(e._s(e.item.name))])]),e._v(" "),e._l(e.starIds,(function(t){return[a("input",{directives:[{name:"model",rawName:"v-model",value:e.feedback.ratingValue,expression:"feedback.ratingValue"}],key:"stars_input_"+t.id,class:t.class,attrs:{id:t.id,type:"radio",name:"ratingValue",disabled:e.isRated},domProps:{value:t.value,checked:e._q(e.feedback.ratingValue,t.value)},on:{click:function(a){return e.handleRating(t.value)},change:function(a){return e.$set(e.feedback,"ratingValue",t.value)}}}),e._v(" "),a("label",{key:"stars_label_"+t.id,staticClass:"new_star",attrs:{for:t.id}},[a("span",{staticClass:"d-none"},[e._v(e._s(t.id))]),e._v(" "),a("svg",{class:t.class,staticStyle:{"fill-rule":"evenodd","clip-rule":"evenodd","stroke-linejoin":"round","stroke-miterlimit":"2"},attrs:{for:t.id,width:"100%",height:"100%",viewBox:"0 0 31 30",version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink","xml:space":"preserve","xmlns:serif":"http://www.serif.com/"}},[a("path",{staticStyle:{"fill-rule":"nonzero"},attrs:{d:"M30.5,11.564c0,0.265 -0.156,0.553 -0.469,0.866l-6.544,6.382l1.55,9.014c0.012,0.085 0.018,0.205 0.018,0.361c0,0.252 -0.063,0.466 -0.189,0.64c-0.126,0.174 -0.31,0.261 -0.55,0.261c-0.228,0 -0.469,-0.072 -0.721,-0.216l-8.095,-4.255l-8.095,4.255c-0.264,0.144 -0.505,0.216 -0.721,0.216c-0.253,0 -0.442,-0.087 -0.568,-0.261c-0.126,-0.174 -0.189,-0.388 -0.189,-0.64c0,-0.072 0.012,-0.192 0.036,-0.361l1.55,-9.014l-6.562,-6.382c-0.301,-0.325 -0.451,-0.613 -0.451,-0.866c0,-0.444 0.337,-0.721 1.01,-0.829l9.05,-1.316l4.057,-8.203c0.228,-0.493 0.522,-0.739 0.883,-0.739c0.361,0 0.655,0.246 0.883,0.739l4.057,8.203l9.05,1.316c0.673,0.108 1.01,0.385 1.01,0.829Z"}})])])]}))],2)])]),e._v(" "),a("a",{attrs:{href:e.item.url}},[a("img",{staticClass:"py-2",attrs:{alt:"image "+e.item.name,src:e.item.image}}),e._v(" "),a("span",{staticClass:"feedback-item-title"},[e._v(e._s(e.item.name))])]),e._v(" "),a("div",{staticClass:"feedback-item-link"},e._l(e.item.attributes,(function(t){return a("div",{key:e.item.itemId+"-"+t.valueId},[a("strong",[e._v(e._s(t.attribute.names.name)+": ")]),e._v(" "),a("span",[e._v(e._s(t.value.names.name))])])})),0)])};b._withStripped=!0;var f={name:"FeedbackOrderItem",props:{item:Object,numberOfColumns:Number},data:function(){return{isRated:!1,feedback:{ratingValue:0,authorName:"",title:"",message:"",type:"review",targetId:0,honeypot:""}}},computed:{starIds:function(){for(var e=[],t=this.isRated?"star-rated":"star",a=5;a>0;a--)e.push({value:a,id:"star-"+a+"-"+this.item.variationId,class:t});return e},variationAttributes:function(){return null}},mounted:function(){var e=this;vueEventHub.$on("orderItemFeedback_created",(function(t){t.feedback.targetId===e.item.variationId&&(e.feedback=t.feedback,e.isRated=!0)}))},methods:{handleRating:function(e){!this.isRated&&e>0&&(this.feedback.ratingValue=e),vueEventHub.$emit("orderItemFeedback_showform",{item:this.item,feedback:this.feedback,isRated:this.isRated})}}},k=(0,l.A)(f,b,[],!1,null,null,null);k.options.__file="resources/js/src/app/components/order/FeedbackOrderItem.vue";var v={name:"FeedbackOrder",components:{"feedback-order-form":m,"feedback-order-item":k.exports},mixins:[a(4304).A],props:{variations:Object,items:Array,itemUrls:Object,itemImages:Object,options:Object,splitItemBundles:Number,accessKey:String,orderId:String},data:function(){return{isLoading:!0,page:1}},computed:{orderItems:function(){for(var e=[],t=0;t<this.items.length;t++)if(this.items[t].itemVariationId>0&&-1===this.items[t].orderItemName.indexOf("[-]")){var a=this.items[t].itemVariationId,i=this.variations[a].variation.bundleType,s=this.items[t].orderItemName;if(e.push({name:this.filterItemName(s,i),image:this.itemImages[a],url:this.itemUrls[a],variationId:a,itemId:this.variations[a].item.id,attributes:this.variations[a].attributes}),"bundle"===i&&this.splitItemBundles<1)for(var r=0;r<this.items[t].bundleComponents.length;r++){var n=this.items[t].bundleComponents[r].data.variation.id;e.push({name:this.$options.filters.itemName(this.items[t].bundleComponents[r].data),image:this.itemImages[n],url:this.itemUrls[n],variationId:n,itemId:this.items[t].bundleComponents[r].data.itemId,attributes:this.items[t].bundleComponents[r].data.attributes})}}return e},pagination:function(){var e=this.page*this.options.itemsPerRow*this.options.rowsPerPage;return this.orderItems.slice(0,e)},trueItemsPerRow:function(){return Math.min(this.orderItems.length,this.options.itemsPerRow)}},mounted:function(){var e=this;$.when(this.getUser()).done((function(){e.isLoading=!1,Vue.nextTick((function(){window.dispatchEvent(new Event("resize"))}))}))},methods:{getUser:function(){for(var e=[],t=[],a=0;a<this.orderItems.length;a++){var i=this.orderItems[a];e.push(i.itemId),t.push(i.variationId)}var s={itemIds:e,variationIds:t,allowFeedbacksOnlyIfPurchased:!1,numberOfFeedbacks:this.options.numberOfFeedbacks};return this.orderId&&this.accessKey&&(s.orderId=this.orderId,s.accessKey=this.accessKey),this.$store.dispatch("loadFeedbackUser",{data:s,itemId:this.itemId,variationId:this.variationId})},nextPage:function(){this.page*this.options.itemsPerRow*this.options.rowsPerPage<this.orderItems.length&&(this.page+=1)},filterItemName:function(e,t){return"bundle"===t?e.replace("[BUNDLE]",""):"bundle_item"===t?e.replace("[-]",""):e}}},h=(0,l.A)(v,i,[],!1,null,null,null);h.options.__file="resources/js/src/app/components/order/FeedbackOrder.vue";var p=h.exports}}]);
//# sourceMappingURL=feedback-5.min.js.map